name: Build and Release

on:
  push:
    tags:
      - 'v*.*.*'  # Triggers on version tags like v1.0.0, v3.1.0, etc.

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write  # Required to create releases and upload assets
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4.1.1
    
    - name: Set up Python
      uses: actions/setup-python@v5.0.0
      with:
        python-version: '3.12'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Build executable with PyInstaller
      run: |
        pyinstaller main.spec
    
    - name: Create release archive
      run: |
        mkdir release
        copy dist\GeradorFichasPayer.exe release\
        copy .env.example release\
        copy README.md release\
        Compress-Archive -Path release\* -DestinationPath GeradorFichas-${{ github.ref_name }}.zip
      shell: powershell
    
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v2.0.4
      with:
        files: GeradorFichas-${{ github.ref_name }}.zip
        body: |
          ## Gerador de Fichas de Implantação ${{ github.ref_name }}
          
          ### Como usar:
          1. Baixe o arquivo `GeradorFichas-${{ github.ref_name }}.zip`
          2. Extraia o conteúdo em uma pasta de sua preferência
          3. Renomeie o arquivo `.env.example` para `.env`
          4. Edite o arquivo `.env` e insira seu token da API TomTicket
          5. Execute o arquivo `GeradorFichasPayer.exe`
          
          ### Conteúdo do pacote:
          - `GeradorFichasPayer.exe` - Executável principal
          - `.env.example` - Arquivo de exemplo para configuração
          - `README.md` - Documentação completa
          
          Para mais informações, consulte o [README.md](https://github.com/mauricio-luan/gerador-fichas-3.0/blob/main/README.md)
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
